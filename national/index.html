<!DOCTYPE html>
<meta charset="utf-8">
<style>

/* ['#8dd3c7','#ffffb3','#bebada','#fb8072','#80b1d3', '#cdc'] */

.sr { 
  stroke: #999;
  stroke-width: 2px;
}
  
.sr.Ayeyarwady { fill: #8dd3c7; }
.sr.Bago { fill: #8dd3c7; }
.sr.Chin { fill: #ffffb3; }
.sr.Kachin { fill: #C6E9BD; }
.sr.Kayah { fill: #8dd3c7; }
.sr.Kayin { fill: #8dd3c7; }
.sr.Magway { fill: #C6E9BD; }
.sr.Mon { fill: #8dd3c7; }
.sr.Rakhine { fill: #8dd3c7; }
.sr.Sagaing { fill: #ffffb3; }
.sr.Shan { fill: #C6E9BD; }
.sr.Tanintharyi { fill: #8dd3c7; }
.sr.Yangon { fill: #8dd3c7; }
.sr.Mandalay { fill: #ffffb3; }
.sr.Naypyitaw { fill: #8dd3c7; }
  
  
body {
  font-size: 18px;
  font-family: sans-serif;
  font-weight: 200;
  text-anchor: left;
} 
  
.paperName {
  font-size: 20px;
  display: inline;
  color: #000;
  font-style: italic;
}
  
.paperBox {
  background-color: lightblue;
  vertical-align: top;
  margin: 3px;
  padding: 3px;
}  
  
.state-daily {
  background-color: #119977;
  fill: #119977;
} 
  
.military-daily {
  background-color: #009900;
  fill: #009900;
} 
  
.private-daily {
  background-color: #ff6666;
  fill: #ff6666;
} 
  
.municipal-government-daily {
  background-color: #9fdf9f;
  fill: #9fdf9f;
} 
  
.political-party-daily {
  background-color: #cccc00;
  fill: #cccc00;
} 
  
.top-distributor {
  background-color: #bb88aa;
  fill: #bb88aa;
} 
  
.Yangon-distribution {
  background-color: #8dd3c7;
  fill: #8dd3c7;
}  
  
.Mandalay-distribution {
  background-color: #ffffb3;
  fill: #ffffb3;
}    
  
.Yangon-and-Mandalay-distribution {
  background-color: #C6E9BD;
  fill: #C6E9BD;
}    
  
.significant-distributor {
  background-color: #ba9487;
  fill: #ba9487;
} 
  
.state-distributor {
  background-color: #a1ba87;
  fill: #a1ba87;
} 
   
.blank {
  background-color: #fff;
  fill: #fff;
}  
  
.subunit-label {
  fill: #555;
/*  fill: #333;*/
  fill-opacity: .99;
  font-size: 30px;
  font-family: sans-serif;
  font-weight: 500;
  text-anchor: middle;
}
  
.place-label, .place-label-capitals {
/*  fill: #777;*/
  fill: #f00;
/*  fill-opacity: .99;*/
  font-size: 25px;
  font-family: sans-serif;
  font-weight: 500;
  text-anchor: left;
}  

.hidden { display: none; }  
  
.annotation circle {
  fill: none;
  stroke: black;
}

.annotation path {
  fill: none;
  stroke: black;
  shape-rendering: crispEdges;
}

.annotation text {
  text-shadow: -2px 0 2px #fff, 
                0 2px 2px #fff,
                2px 0 2px #fff, 
                0 -2px 2px #fff;
}  
  
.annotePath {
  stroke-width: 3px;
} 
.annoteCircle {
  stroke-width: 3px;
}
  
.yaxis path{
  display: none;
}

.yaxis line {
    fill: none;
    stroke: black;
    stroke-width: 3px;
    shape-rendering: crispEdges;
}

.yaxis text {
    font-size: 30px;
    z-index: 10;
    padding: 8px;
}  
  
.legendTitle {
    font-size: 50px;
    z-index: 10;
    padding: 8px;
}
  
.mainTitle {
    font-size: 100px;
    width: 3200px;
    z-index: 10;
    padding: 8px;
    text-align: center;
}  
  
#legendContainer {
    width: 800px;
    display: inline-block;
    float:left;
} 
  
#iconContainerPrint, #iconContainerOther {
    width: 1000px;
    display: inline-block;
    vertical-align: top;
} 
  
#mapDescription {
    font-size: 25px;
    width: 2500px;
    display: inline-block;
    vertical-align: top;
} 
  
.iconBox {
    white-space:nowrap;
    display: inline-block;
}  
  
.icon {
  width: 50px;
  padding-left: 20px;
  padding-right: 10px;
  padding-top: 5px;
}

.row {
    float:left;
    width: 4000px;
    overflow: auto;
/*    white-space: nowrap;*/
}
    
  
</style>
<body>

<div class="mainTitle">NATIONAL PRINT NEWS MEDIA DISTRIBUTION MAP</div>  
<!--<div id="#vis"></div>-->
<!--
<label>
  <input type="checkbox" checked="true">
  Hide controls
</label> 
-->
<div class="row">
<div id="legendContainer"></div>
<!--<img src="icons/bookshop.svg" class='icon'>-->
<br/>
<div id="iconContainerPrint"><br/><br/><br/></div>
<div id="iconContainerOther"><br/><br/><br/></div>
<div id="mapDescription"><br/><br/>This map illustrates national daily newspaper distribution in Myanmar, including by the state, military, private sector, political parties and municipal governments. The state and military have their own distribution networks and printing presses in multiple locations. None of the private media have access to the extensive state infrastructure. The majority of private daily newspapers are printed on their own printing presses in Yangon. A few also print in Mandalay and, to a lesser extent, in Naypyidaw. All of the private national dailies use mainstream distributors in Yangon and Mandalay to distribute their papers across the country. The two leading distributors in Mandalay have an estimated 75-80% market share in Mandalay and Upper Myanmar. The 5-7 leading distributors in Yangon have an estimated 50-70% market share in Yangon and the lower part of the country; some of them also work in Upper Myanmar, in partnership with the Mandalay distributors, or directly with local distributors in the states and regions. Some private newspapers also use their own networks to supplement distribution. The majority of newspapers are distributed by truck and, in some cases, by express bus or plane. Some small distributors may also use boats, for example, in certain parts of the Ayeyarwady Region. In Yangon, most newspapers are distributed by hawkers, as well as in bookshops, newsstands and supermarkets. The media boxes on this map indicate the regional and state centers where daily national newspapers are available. Some of the dailies are also (re)distributed further afield. There are also dozens of state and private weekly and monthly news journals and magazines printed and distributed in many locations around the country. While endeavouring to the comprehensive and accurate, due to the large number of media, the challenges of confirming data, and the transitional nature of the sector, the information is not exhaustive.
</div>
<!--  These maps illustrate the townships where the grantees say they distribute their print products. If a township is shaded it means there is some kind of print distribution within its borders. The number of journals distributed by each media outlet ranges from 1000-7000-->
</div> 
<script src="scripts/d3.v3.min.js" charset="utf-8"></script>
<script src="scripts/topojson.v1.min.js"></script>
<script src="scripts/d3-ring-note.js"></script>
<script>

var width = 4000,
    height = 4000;
  
var icons = {
  "distributor-private": {
    name: "private distributor",
    icon: "icons/distributor-private.svg",
    cat: "dist"
  },
  "distributor-state": {
    name: "state distributor",
    icon: "icons/distributor-state.svg",
    cat: "dist"
  },
  "distributor-military": {
    name: "military distributor",
    icon: "icons/distributor-military.svg",
    cat: "dist"
  },
  "printing-press-private": {
    name: "private printing press",
    icon: "icons/printing-press-private.svg",
    cat: "print"
  },
  "printing-press-state": {
    name: "state printing press",
    icon: "icons/printing-press-state.svg",
    cat: "print"
  },
  "printing-press-military": {
    name: "military printing press",
    icon: "icons/printing-press-military.svg",
    cat: "print"
  },
}

var iconsArray = Object.keys(icons).map(function (key) { return icons[key]; });

var places = {
  "Yangon" : {
  "icons" : ["printing-press-private", "printing-press-state", "printing-press-military", "distributor-private", "distributor-state", "distributor-military"],
  "iconAnnote" : {}
  },
  "Mandalay": {
  "icons" : ["printing-press-private", "printing-press-state", "printing-press-military", "distributor-private", "distributor-state", "distributor-military"],
  "iconAnnote" : {}
  },
  "Naypyitaw": {
  "icons" : ["printing-press-private", "printing-press-state", "printing-press-military", "distributor-state", "distributor-military"],
  "iconAnnote" : {}
  },
  "Taunggyi": {
  "icons" : ["printing-press-state", "distributor-state"],
  "iconAnnote" : {"distributor-state" : "Shan State"}
  },
  "Kengtung": {
  "icons" : ["printing-press-state", "distributor-state"],
  "iconAnnote" : {"distributor-state" : "Shan State"}
  },
  "Sagaing": {
  "icons" : ["printing-press-state", "distributor-state"],
  "iconAnnote" : {"distributor-state" : "Sagaing Region"}
  },
  "Myitkyina": {
  "icons" : ["printing-press-state", "distributor-state"],
  "iconAnnote" : {"distributor-state" : "Kachin State"}
  },
  "Sittwe": {
  "icons" : ["printing-press-state", "distributor-state"],
  "iconAnnote" : {"distributor-state" : "Rakhine State"}
  },
  "Lashio": {
  "icons" : ["printing-press-state", "distributor-state"],
  "iconAnnote" : {"distributor-state" : "Shan State"}
  },
  "Myeik": {
  "icons" : ["printing-press-state", "distributor-state"],
  "iconAnnote" : {"distributor-state" : "Tanintharyi Region"}
  },
  "Mawlamyine": {
  "icons" : ["printing-press-state", "distributor-state"],
  "iconAnnote" : {"distributor-state" : "Mon State"}
  },
  "Monywa": {
  "icons" : ["printing-press-state", "distributor-state"],
  "iconAnnote" : {"distributor-state" : "Sagaing Region"}
  }
}


//////// Legend /////////


var legendHeight = 600;
var svg = d3.select("body").append("svg")
  .attr("width", width)
  .attr("height", height+legendHeight);  
 
var svgLegend = d3.select("#legendContainer").append("svg")
  .attr("width", 1200)
  .attr("height", legendHeight+200);  
  
  
svgLegend.append("g").append("text")
    .attr("class", "legendTitle")
    .attr("transform", "translate(150,100)")
    .text("Legend:");  
  
//svg.append("g").append("text")
//    .attr("class", "legendTitle")
//    .attr("transform", "translate(150,100)")
//    .text("Legend:");
  
var legendColors = {
  "top distributor": "lightblue",
  "significant distributor": "lightblue",
  "state distributor": "lightblue",
  "Yangon distribution": "lightblue",
  "Mandalay distribution": "lightblue",
  "Yangon and Mandalay distribution": "lightblue",
  "": "white",
  "state daily": "lightblue",
  "military daily": "lightblue",
  "private daily": "lightblue",
  "municipal government daily": "lightblue",
  "political party daily": "lightblue",
} 
  
var legendYScaleColors = d3.scale.ordinal()
                          .domain(Object.keys(legendColors))
                          .rangePoints([0,legendHeight],3);

//console.log(legendYScaleColors("political affiliation"));

var legendYAxisColors = d3.svg.axis()
                          .scale(legendYScaleColors)
                          .orient("right")
                          .tickPadding(20);
  
svgLegend.append("g")
    .attr("class", "yaxis")
    .attr("transform", "translate(200,100)")
    .call(legendYAxisColors)
    .selectAll(".tick")
    .each(function() { 
        d3.select(this)
          .append("circle")
          .attr("r", 20)
          .attr("class", function(d) {
            if (d == "") return "blank";
            else return d.replace(/\s+/g, '-');
          });
    })
    .selectAll("line").remove();  
  
var legendSubtitlePrint = document.createElement("h2");
var tSubtitlePrint = document.createTextNode("Printing Presses"); 
legendSubtitlePrint.appendChild(tSubtitlePrint);

document.getElementById("iconContainerPrint").appendChild(legendSubtitlePrint);
  
for (ic in iconsArray) {
  if (iconsArray[ic].cat == "print") {
    console.log(ic);
    var oImg=document.createElement("img");
    oImg.setAttribute('src', iconsArray[ic].icon);
    oImg.setAttribute('class', 'icon');

    var para = document.createElement("div");
    var t = document.createTextNode(iconsArray[ic].name); 
    para.appendChild(t);

    var iconBox = document.createElement("div");
    iconBox.setAttribute('class', 'iconBox');

    iconBox.appendChild(oImg);
    iconBox.appendChild(t);

    document.getElementById("iconContainerPrint").appendChild(iconBox);
  }
}
  
var legendSubtitleOther = document.createElement("h2");
var tSubtitleOther = document.createTextNode("Distributors"); 
legendSubtitleOther.appendChild(tSubtitleOther);

document.getElementById("iconContainerOther").appendChild(legendSubtitleOther);
  
for (ic in iconsArray) {
  if (iconsArray[ic].cat != "print") {
    console.log(ic);
    var oImg=document.createElement("img");
    oImg.setAttribute('src', iconsArray[ic].icon);
    oImg.setAttribute('class', 'icon');

    var para = document.createElement("div");
    var t = document.createTextNode(iconsArray[ic].name); 
    para.appendChild(t);

    var iconBox = document.createElement("div");
    iconBox.setAttribute('class', 'iconBox');

    iconBox.appendChild(oImg);
    iconBox.appendChild(t);

    document.getElementById("iconContainerOther").appendChild(iconBox);
  }
}
  

  
  
//////// Start declaring viz /////////  
  
//var svg = d3.select("body").append("svg")
//    .attr("width", width)
//    .attr("height", height);  
  

  
var placeR = 15;
  
var numFormat = d3.format(",");
  
var capitalCities = [
  {
    "place": "Myitkyina",
    "lat" : 25.387488,
    "lon" : 97.390355
  },
  {
    "place": "Loikaw",
    "lat" : 19.67424,
    "lon" : 97.20993
  },
  {
    "place": "Hpa-An",
    "lat" : 16.880764,
    "lon" : 97.636909
  },
  {
    "place": "Hakha",
    "lat" : 22.640108,
    "lon" : 93.604834
  },
  {
    "place": "Sagaing",
    "lat" : 21.880079,
    "lon" : 95.962311
  },
  {
    "place": "Dawei",
    "lat" : 14.076799,
    "lon" : 98.189521
  },
  {
    "place": "Bago",
    "lat" : 17.335828,
    "lon" : 96.483893
  },
  {
    "place": "Magway",
    "lat" : 20.14027,
    "lon" : 94.926959
  },
  {
    "place": "Mandalay",
    "lat" : 21.99275,
    "lon" : 96.09641
  },
  {
    "place": "Mawlamyine",
    "lat" : 16.484591,
    "lon" : 97.625931
  },
  {
    "place": "Sittwe",
    "lat" : 20.137266,
    "lon" : 92.885506
  },
  {
    "place": "Yangon",
    "lat" : 16.783656,
    "lon" : 96.156831
  },
  {
    "place": "Taunggyi",
    "lat" : 20.774773,
    "lon" : 97.035979
  },
  {
    "place": "Pathein",
    "lat" : 16.77924,
    "lon" : 94.733028
  },
  {
    "place": "Naypyitaw",
    "lat" : 19.80326,
    "lon" : 96.18566
  },
  {
    "place": "Kalay",
    "lat" : 23.193301,
    "lon" : 94.02977
  }
];
  



d3.csv("data/national_papers.csv", function(error1, papers_raw) {
d3.json("data/myanmar_sr.json", function(error2, mm_sr) {
  if (error1) return console.error(error1);
  if (error2) return console.error(error2);
  console.log(mm_sr);
  console.log(papers_raw);
  
  var papersNest = d3.nest()
    .key(function(d) { return d.location; })
    .entries(papers_raw);

  
  for (p in papersNest) {
    if (places[papersNest[p].key]) {
      papersNest[p].icons = places[papersNest[p].key].icons;
      papersNest[p].iconAnnote = places[papersNest[p].key].iconAnnote;
    }
    papersNest[p].lat = +papersNest[p].values[0].lat;
    papersNest[p].lon = +papersNest[p].values[0].lon;
  }
  
  console.log(papersNest);

  
//  svg.append("path")
//      .datum(topojson.feature(mm_sr, mm_sr.objects.states_regions))
//      .attr("d", d3.geo.path().projection(d3.geo.mercator()));
  
  
  var sr = topojson.feature(mm_sr, mm_sr.objects.states_regions);

  var projection = d3.geo.mercator()
    .center([97, 19.5])
//    .rotate([0, 0])
//    .parallels([9, 29])
    .scale(10000)
    .translate([width / 2, height / 2]);
  
//  geo.mercator()
//    .scale(500)
//    .translate([width / 2, height / 2]);
  
  var path = d3.geo.path()
    .projection(projection);
  
  svg.append("path")
    .datum(sr)
    .attr("d", path);
  
  svg.selectAll(".sr")
    .data(topojson.feature(mm_sr, mm_sr.objects.states_regions).features)
  .enter().append("path")
    .attr("class", function(d) { 
//      console.log(d);
      return "sr " + d.properties.st; 
    })
    .attr("d", path);
  
  ///// State and Region Names /////////////////////////////////////////
  
  svg.selectAll(".subunit-label")
    .data(topojson.feature(mm_sr, mm_sr.objects.states_regions).features)
  .enter().append("text")
    .attr("class", function(d) { return "subunit-label " + d.properties.st; })
    .attr("transform", function(d) { 
      
      var pos = path.centroid(d);
      var dx = 0;
      var dy = 0;
      if (d.properties.st == "Naypyitaw") dy = -30;
      if (d.properties.st == "Mon") { dx = 50; dy = 20; }
      if (d.properties.st == "Ayeyarwady") dy = -30;
      if (d.properties.st == "Yangon") dy = -10;
      if (d.properties.st == "Rakhine") { dx = 20; dy = -55; }
      if (d.properties.st == "Magway") { dx = 30; }
//      if (d.properties.st == "Tanintharyi") { dx = 70; dy = 75; }
      return "translate(" + [pos[0]+dx,pos[1]+dy] + ")"; 
//      return "translate(" + path.centroid(d) + ")"; 
    })
    .attr("dy", ".35em")
    .text(function(d) { return d.properties.st; });
  
  
  ///// Capital Cities /////////////////////////////////////////////////
  
  var capitalCircles = svg.selectAll("capitalCircle")
    .data(capitalCities)
    .enter()
    .append("circle")
    .attr("transform", function(d) { 
      var pos = projection([d.lon,d.lat]);
      return "translate(" + [pos[0],pos[1]] + ")"; 
    });
  
  capitalCircles
   .attr("r", function (d) { return placeR; })
   .style("fill", function(d) { return "#333"; });
  
  
  svg.selectAll(".place-label-capitals")
    .data(capitalCities)
  .enter().append("text")
    .attr("class", "place-label-capitals")
    .attr("transform", function(d) { 
      console.log(d);
      var pos = projection([d.lon,d.lat]);
      var dx = 25;
      var dy = 0;
      if (d.place == "Sagaing") dx = -120;
      if (d.place == "Mawlamyine") dx = -170;
      return "translate(" + [pos[0]+dx,pos[1]+dy] + ")"; 
    })
    .attr("dy", ".35em")
    .text(function(d) { return d.place; })
  
  ///// Cities with Agencies ///////////////////////////////////////////
  
  var placeCircles = svg.selectAll("placeCircle")
    .data(papersNest)
    .enter()
    .append("circle")
    .attr("transform", function(d) { 
      return "translate(" + projection([d.lon,d.lat]) + ")"; 
    });
  
  placeCircles
   .attr("r", function (d) { return placeR; })
   .style("fill", function(d) { return "#333"; });
  
  
  svg.selectAll(".place-label")
    .data(papersNest)
  .enter().append("text")
    .attr("class", "place-label")
    .attr("transform", function(d) { 
      console.log(d);
      var pos = projection([d.lon,d.lat]);
      var dx = 25;
      var dy = 0;
      if (d.key == "Sagaing") dx = -120;
      if (d.key == "Mawlamyine") dx = -170;
      return "translate(" + [pos[0]+dx,pos[1]+dy] + ")"; 
    })
    .attr("dy", ".35em")
    .text(function(d) { return d.key; })
  
  //// Cities Helper Functions ////////////////////////////////////
  
  function cityLabel(d) { 
    console.log(d);
    var pos = projection([d.lon,d.lat]);
    var dx = 25;
    var dy = 0;
    if (d.key == "Sagaing") dx = -120;
    if (d.key == "Mawlamyine") dx = -160;
    return "translate(" + [pos[0]+dx,pos[1]+dy] + ")"; 
  }
  //// Annotations ////////////////////////////////////////////////
  
  
var ringNote = d3.ringNote()
  .draggable(false);
  
function makeAnnotations(dataset) {
  
  var pos = [];
  
  for (p in dataset) {
    
    pos = projection([dataset[p].lon,dataset[p].lat]);
    
    dataset[p].cx = pos[0];
    dataset[p].cy = pos[1];
    dataset[p].r = placeR + 5;
    dataset[p].text = "<h2>" + dataset[p].key + "</h2>";
    
    if (dataset[p].icons) {
      for (ic in dataset[p].icons) {
        console.log(dataset[p].icons[ic] , dataset[p].key);
        dataset[p].text += "<div class='iconBox'>&nbsp;<img src='"+ icons[dataset[p].icons[ic]].icon +"' class='icon'> ";
        if (dataset[p].iconAnnote[dataset[p].icons[ic]])
          dataset[p].text += "(" + dataset[p].iconAnnote[dataset[p].icons[ic]] + ")";
        dataset[p].text += " </div>";
      }
    }
    
    dataset[p].text += "<table><tr><td valign='top' width='300'>"
    for (a in dataset[p].values) {
      if (dataset[p].key == "Yangon" && a==7) dataset[p].text += "</td><td valign='top' width='300'>"
      if (dataset[p].key == "Yangon" && a==13) dataset[p].text += "</td><td valign='top' width='300'>"
      if (dataset[p].key == "Mandalay" && a==2) dataset[p].text += "</td><td valign='top' width='300'>"
      dataset[p].text += "<div class='paperBox " 
        + dataset[p].values[a].type.replace(/\s+/g, '-') + "'>"
      dataset[p].text += "<b><div class='paperName'>" 
        + dataset[p].values[a].name + "</div></b>";
      
//      if (dataset[p].values[a].type.length)
//        dataset[p].text += "</br><b>Type:</b> " + dataset[p].values[a].type;
      
      if (dataset[p].values[a].printed.length) {
        if (dataset[p].values[a].printed_caveat.length)
          dataset[p].text += "</br><b>Copies Printed:</b> " + dataset[p].values[a].printed_caveat; 
        else
          dataset[p].text += "</br><b>Copies Printed:</b> " + numFormat(+dataset[p].values[a].printed);
      }
      
      
      if (dataset[p].values[a].distributed.length)
        dataset[p].text += "</br><b>Distribution in " + dataset[p].key + ":</b> " + numFormat(+dataset[p].values[a].distributed);
      
      if (dataset[p].values[a].language.length)
        dataset[p].text += "</br><b>Language:</b> " + dataset[p].values[a].language;
      
      if (dataset[p].values[a].owner_publisher.length)
        dataset[p].text += "</br><b>Owner or Publisher:</b> " + dataset[p].values[a].owner_publisher;
      
      if (dataset[p].values[a].pages.length)
        dataset[p].text += "</br><b>Pages:</b> " + dataset[p].values[a].pages;
      
      if (dataset[p].values[a].year_founded.length)
        dataset[p].text += "</br><b>Year Founded:</b> " + dataset[p].values[a].year_founded;
      
      if (dataset[p].values[a].printing_location.length)
        dataset[p].text += "</br><b>Printing Location:</b> " + dataset[p].values[a].printing_location;
      
//      if (dataset[p].values[a].comment)
//        dataset[p].text += "</br><b>Remark:</b> " + dataset[p].values[a].comment;
      
      dataset[p].text += "</div>"
    }
    dataset[p].text += "</td></tr></table>"
    
    if (dataset[p].cx > width/2) {
      dataset[p].textOffset = [100, 200];  
    } else {
      dataset[p].textOffset = [-100, 200];  
    }
    
    switch (dataset[p].key) { 
      case "Sagaing":
        dataset[p].textOffset = [100-dataset[p].cx, -700];
        break; 
      case "Monywa":
        dataset[p].textOffset = [100-dataset[p].cx, -75];
        break;  
      case "Magway":
        dataset[p].textOffset = [500-dataset[p].cx, -400];
        break;    
      case "Sittwe":
        dataset[p].textOffset = [100-dataset[p].cx, 150];
        break; 
      case "Yangon":
        dataset[p].textOffset = [100-dataset[p].cx, 350];
        break;   
      case "Naypyitaw":
        dataset[p].textOffset = [500-dataset[p].cx, 150];
        break;    
      case "Pathein":
        dataset[p].textOffset = [900-dataset[p].cx, -150];
        break;   
      case "Mawlamyine":
        dataset[p].textOffset = [1100-dataset[p].cx, 400];
        break;     
      case "Dawei":
        dataset[p].textOffset = [1500-dataset[p].cx, 100];
        break;     
      case "Loikaw":
        dataset[p].textOffset = [2300-dataset[p].cx, 90];
        break;     
      case "Taunggyi":
        dataset[p].textOffset = [2700-dataset[p].cx, 200];
        break;      
      case "Bago":
        dataset[p].textOffset = [2700-dataset[p].cx, 250];
        break;   
      case "Hpa-An":
        dataset[p].textOffset = [2700-dataset[p].cx, 600];
        break; 
      case "Myeik":
        dataset[p].textOffset = [2700-dataset[p].cx, 250];
        break; 
      case "Myitkyina":
        dataset[p].textOffset = [3100-dataset[p].cx, -700];
        break;  
      case "Lashio":
        dataset[p].textOffset = [3100-dataset[p].cx, -600];
        break;    
      case "Kengtung":
        dataset[p].textOffset = [3100-dataset[p].cx, -300];
        break;    
      case "Mandalay":
        dataset[p].textOffset = [3100-dataset[p].cx, 200];
        break;
        
    }
  }
  
}

makeAnnotations(papersNest);
  
var gAnnotations = svg.append("g")
.attr("class", "annotations")
.call(ringNote, papersNest);

gAnnotations.selectAll(".annotation circle")
  .classed("hidden", function(d) { return d.hideCircle; });

// Hide or show the controls
var draggable = false;
d3.select("input")
  .on("change", function() {
    ringNote.draggable(draggable = !draggable);
    gAnnotations
        .call(ringNote, papersNest)
      .selectAll(".annotation circle")
        .classed("shaded", function(d) { return d.shaded; });
  });
  


})});
  
</script>